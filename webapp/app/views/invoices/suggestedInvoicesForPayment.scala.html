
@(payment: PaymentAndUser, invoices: Iterable[InvoiceAndUser])

@stdlayout("Afrekeningen van betaling") {

  @panel("Debiteurenbeheer", "fa-bar-chart") {
        <div class="col-xs-12">
            @btnPrimary("Afrekeningen", routes.Invoices.getAll())
            @btnPrimary("Betalingen", routes.Payments.getAll())
            @btnPrimary("Coda uploaden", routes.Codas.uploadCoda())
            @btnPrimary("Rappels", routes.Reminders.getAll())
            @btnPrimary("Statistieken", routes.PaymentStatistics.getStats())
            @btnPrimary("Statistieken per gebruiker", routes.PaymentStatistics.getUserStats())
        </div>
  }

  @panel("Details", "fa-bar-chart-o"){
      <div class="col-sm-6">
          <h4>Betaling</h4>
          <dl class="dl-horizontal">
              <dt>Betalingsnummer</dt>
              <dd>@payment.getPayment.getNumber</dd>
              <dt>Datum</dt>
              <dd>@payment.getPayment.getDate</dd>
              <dt>Rekeningnummer</dt>
              <dd>@payment.getPayment.getAccountNumber</dd>
              <dt>Rekeninghouder</dt>
              <dd>@payment.getPayment.getName</dd>
              <dt>Gebruiker</dt>
              <dd>
                @if(payment.getPayment.getUserId == 0) {
                  Geen gebruiker gevonden
                } else {
                  @payment.getPayment.getUserId - @payment.getUser.getFirstName @payment.getUser.getLastName
                }
              </dd>
              <dt>Adres</dt>
              <dd>@payment.getPayment.getAddress</dd>
              <dt>Bank</dt>
              <dd>@payment.getPayment.getBank</dd>
              <dt>Bedrag</dt>
              <dd>@payment.getPayment.getAmount</dd>
              <dt>Status</dt>
              <dd>
                @if(payment.getPayment.getStatus == PaymentStatus.OK) {
                  <span class="label label-success">OK</span>
                } else {
                  @if(payment.getPayment.getStatus == PaymentStatus.CHANGE) {
                    <span class="label label-warning">Te bekijken</span>
                  } else {
                    @if(payment.getPayment.getStatus == PaymentStatus.UNASSIGNED) {
                      <span class="label label-danger">Geen afrekening</span>
                    }
                  }
                }
              </dd>
              <dt>Vrije communicatie</dt>
              @if(payment.getPayment.getComment == null) {
                  <dd>-</dd>
              } else {
                  <dd>@payment.getPayment.getComment</dd>
              }
              <dt>Gestructureerde communicatie</dt>
              @if(payment.getPayment.getStructuredCommunication == null) {
                  <dd>-</dd>
              } else {
                  <dd>@payment.getPayment.getStructuredCommunication</dd>
              }
              <dt>Munteenheid</dt>
              <dd>@payment.getPayment.getCurrency</dd>
              <dt>Filename</dt>
              <dd>@payment.getPayment.getFilename</dd>
          </dl>
      </div>
  }

<div id="resultsTable" class="table-responsive col-xs-12">
    <table class="table table-striped table-bordered table-hover no-footer" id="dataTables-cars">
        <thead>
            <tr role="row">
                <th name="number" class="sortable" tabindex="0" >Nummer</th>
                <th name="date" class="sortable" tabindex="0" >Datum</th>
                <th name="payment_date" class="sortable" tabindex="0" >Betalingsdatum</th>
                <th name="due_date" class="sortable" tabindex="0" >Uiterste betalingsdatum</th>
                <th name="user_id" class="sortable" tabindex="0" >Gebruiker</th>
                <th name="amount" class="sortable" tabindex="0" >Bedrag (â‚¬)</th>
                <th name="status" class="sortable" tabindex="0" >Status</th>
                <th name="structured_comm" tabindex="0" >Gestructureerde communicatie</th>
                <th>Acties</th>
            </tr>
        </thead>
        <tbody>
        @foreach.trOrElse(invoices){ invoice =>
            <td> <a href="@routes.Invoices.showDetails(invoice.getInvoice.getId)">@invoice.getInvoice.getNumber</a></td>
            <td>@invoice.getInvoice.getDate</td>
            <td>@invoice.getInvoice.getPaymentDate</td>
            <td>@invoice.getInvoice.getDueDate</td>
            <td>
                <a href="@routes.Profile.index(invoice.getUser.getId)">@invoice.getUser.getFirstName @invoice.getUser.getLastName</a>
                @if(invoice.getUser.getPaymentInfo != null && invoice.getUser.getPaymentInfo != "") {
                    <br>
                    @if(invoice.getUser.getPaymentInfo.length > 10) {
                        ( @invoice.getUser.getPaymentInfo.substring(0, 10) ... )
                    } else {
                        ( @invoice.getUser.getPaymentInfo )
                    }
                }
            </td>
            <td align="right">@invoice.getInvoice.getAmount</td>
            <td>
              @if(invoice.getInvoice.getStatus == InvoiceStatus.PAID) {
                <span class="label label-success">Betaald</span>
              } else {
                @if(invoice.getInvoice.getStatus == InvoiceStatus.OPEN) {
                  <span class="label label-warning">Open</span>
                } else {
                  @if(invoice.getInvoice.getStatus == InvoiceStatus.OVERDUE) {
                    <span class="label label-danger">Te laat</span>
                  }
                }
              }
            </td>
            <td>
              @if(invoice.getInvoice.getStructuredCommunication == null) {
                  -
              } else {
                  @invoice.getInvoice.getStructuredCommunication
              }
            </td>
            <td>
              @btnPrimary("Link afrekening aan betaling", routes.Payments.createPaymentInvoiceRelationship(invoice.getInvoice.getId, payment.getPayment.getId))
            </td>
        }{
            <tr>
                <td class="empty-row" colspan="12">
                    Geen enkele afrekening voldoet aan jouw zoekterm(en)
                </td>
            </tr>
        }
        </tbody>
    </table>
</div>
}
